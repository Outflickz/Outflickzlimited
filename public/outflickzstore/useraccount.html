<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outflickz - User Account</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="https://i.imgur.com/ioWFyQB.png">
    <style>
        /* Custom Tailwind Configuration (optional: for better focus rings) */
        :focus:not(:focus-visible) {
            outline: none;
        }
        /* Custom transition for view switching */
        .view-transition {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 sm:p-6 md:p-8">

    <div class="w-full max-w-md bg-white shadow-xl rounded-lg p-6 sm:p-8 md:p-10 border border-gray-200">
        
        <div class="flex flex-col items-center mb-8">
            <img 
                src="https://i.imgur.com/1Rxhi9q.jpeg" 
                alt="Outflickz Logo" 
                class="w-20 h-auto mb-3"
            >
            <h1 class="text-3xl font-extrabold text-black tracking-widest">
                OUTFLICKZ
            </h1>
            <p id="auth-header" class="text-gray-600 mt-1 text-lg font-medium">Welcome Back</p>
        </div>

        <div id="auth-views" class="relative overflow-hidden">
            
            <div id="login-view" class="view-transition">
                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="mb-4">
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="login-email" name="email" required 
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="you@example.com"
                        >
                    </div>
                    <div class="mb-6">
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" name="password" required 
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                        >
                    </div>
                    
                    <button type="submit" id="login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Log In
                    </button>
                </form>

                <div class="mt-4 text-center text-sm">
                    <button onclick="showView('forgot')" class="text-blue-600 hover:text-blue-800 transition duration-150 ease-in-out focus:outline-none">
                        Forgot Password?
                    </button>
                    <span class="text-gray-500 mx-2">|</span>
                    <button onclick="showView('create')" class="text-blue-600 hover:text-blue-800 transition duration-150 ease-in-out focus:outline-none">
                        Create an Account
                    </button>
                </div>
            </div>

            <div id="create-view" class="view-transition hidden absolute top-0 w-full opacity-0">
                <form id="create-form" onsubmit="handleCreateAccount(event)">
                    <div class="mb-4">
                        <label for="create-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="create-email" name="email" required 
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="your.new@example.com"
                        >
                    </div>
                    <div class="mb-4">
                        <label for="create-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="create-password" name="password" required 
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Min 8 characters"
                        >
                    </div>
                    <div class="mb-6">
                        <label for="confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                        <input type="password" id="confirm-password" name="confirmPassword" required 
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Re-enter password"
                        >
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Create Account
                    </button>
                </form>

                <div class="mt-4 text-center text-sm">
                    <button onclick="showView('login')" class="text-blue-600 hover:text-blue-800 transition duration-150 ease-in-out focus:outline-none">
                        Back to Login
                    </button>
                </div>
            </div>

            <div id="forgot-view" class="view-transition hidden absolute top-0 w-full opacity-0">
                <form id="forgot-form" onsubmit="handleForgotPassword(event)">
                    <p class="text-sm text-gray-600 mb-5 text-center">
                        Enter your email address and we'll send you a link to reset your password.
                    </p>
                    <div class="mb-6">
                        <label for="forgot-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="forgot-email" name="email" required 
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="you@example.com"
                        >
                    </div>
                    
                    <button type="submit" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
                        Send Reset Link
                    </button>
                </form>

                <div class="mt-4 text-center text-sm">
                    <button onclick="showView('login')" class="text-blue-600 hover:bg-blue-800 transition duration-150 ease-in-out focus:outline-none">
                        Back to Login
                    </button>
                </div>
            </div>

            <div id="profile-view" class="view-transition hidden absolute top-0 w-full opacity-0">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">Your Profile ðŸ‘¤</h2>
                
                <div id="profile-details">
                    <div class="space-y-4">
                        <div class="p-3 bg-gray-50 rounded-md shadow-sm">
                            <h3 class="font-bold text-gray-700">Personal Information</h3>
                            <p class="text-sm text-gray-500">ID: <span id="profile-id" class="font-medium text-gray-800">...</span></p>
                            <p class="text-sm text-gray-500">Email: <span id="profile-email" class="font-medium text-gray-800">...</span></p>
                            <p class="text-sm text-gray-500">Name: <span id="profile-name" class="font-medium text-gray-800">...</span></p>
                            <p class="text-sm text-gray-500">Username: <span id="profile-username" class="font-medium text-gray-800">...</span></p>
                        </div>

                        <div class="p-3 bg-gray-50 rounded-md shadow-sm">
                            <h3 class="font-bold text-gray-700">Account Status</h3>
                            <p class="text-sm text-gray-500">Role: <span id="profile-role" class="font-medium text-gray-800">...</span></p>
                            <p class="text-sm text-gray-500">Verified: <span id="profile-verified" class="font-medium text-gray-800">...</span></p>
                        </div>
                        
                        <div class="p-3 bg-gray-50 rounded-md shadow-sm">
                            <h3 class="font-bold text-gray-700">Membership</h3>
                            <p class="text-sm text-gray-500">Member Since: <span id="profile-member-since" class="font-medium text-gray-800">...</span></p>
                            <p class="text-sm text-gray-500">Last Updated: <span id="profile-last-updated" class="font-medium text-gray-800">...</span></p>
                        </div>
                    </div>
                </div>

                <div class="mt-6 text-center">
                    <button onclick="handleLogout()" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        Log Out
                    </button>
                </div>
            </div>
            
            <div id="message-area" class="mt-6 p-3 text-sm rounded-md hidden"></div>

        </div>
    </div>

    <script>
        const views = {
            'login': document.getElementById('login-view'),
            'create': document.getElementById('create-view'),
            'forgot': document.getElementById('forgot-view'),
            'profile': document.getElementById('profile-view') // NEW VIEW
        };
        const headerElement = document.getElementById('auth-header');
        const messageArea = document.getElementById('message-area');
        const container = document.getElementById('auth-views');

        /**
         * Switches the active authentication view with a fade transition.
         * @param {string} viewName - 'login', 'create', 'forgot', or 'profile'
         */
        function showView(viewName) {
            // Find the currently visible view
            let currentView = Object.values(views).find(v => v.classList.contains('opacity-100') && !v.classList.contains('hidden'));
            
            // Set the new header text
            const headers = {
                'login': 'Welcome Back',
                'create': 'Create Your Account',
                'forgot': 'Reset Your Password',
                'profile': 'Your Account Dashboard' // NEW HEADER
            };
            headerElement.textContent = headers[viewName] || 'Authentication';
            
            // Reset message area (unless switching to profile, where a message might be needed)
            if (viewName !== 'profile') {
                messageArea.classList.add('hidden');
                messageArea.innerHTML = '';
            }

            // Get the view to transition to
            const nextView = views[viewName];

            if (currentView) {
                // 1. Fade out the current view
                currentView.classList.remove('opacity-100');
                currentView.classList.add('opacity-0');
                
                // Set the container height to prevent jump during transition
                container.style.height = `${container.offsetHeight}px`;

                setTimeout(() => {
                    // 2. Hide the current view and prepare the next one
                    currentView.classList.add('hidden');
                    currentView.classList.remove('absolute');
                    
                    nextView.classList.remove('hidden');
                    nextView.classList.add('absolute'); // Position the new view over the old one
                    
                    // Reset container height and wait for the new content to render
                    container.style.height = 'auto';

                    // 3. Fade in the new view
                    setTimeout(() => {
                        // Must be removed from absolute and re-added to allow natural flow
                        nextView.classList.remove('absolute');
                        
                        // Measure the new height after content is fully visible/positioned
                        container.style.height = `${container.offsetHeight}px`;

                        // Now, apply the transition classes
                        nextView.classList.remove('opacity-0');
                        nextView.classList.add('opacity-100');

                        setTimeout(() => {
                            // Clear dynamic height after transition
                            container.style.height = '';
                        }, 300); // Must match CSS transition duration
                    }, 50); // Small delay to ensure DOM is ready for next frame
                }, 300); // Must match CSS transition duration
            } else {
                // Initial load: show login view immediately
                nextView.classList.remove('hidden');
                nextView.classList.remove('opacity-0');
                nextView.classList.add('opacity-100');
            }
        }
        
        // Initial setup to ensure only login is visible and active on load
        document.addEventListener('DOMContentLoaded', () => {
            showView('login');
        });

        /**
         * Displays a temporary message in the message area.
         * @param {string} message - The message text.
         * @param {string} type - 'success', 'error', or 'info'.
         */
        function displayMessage(message, type = 'info') {
            const baseClasses = 'mt-6 p-3 text-sm rounded-md';
            messageArea.className = baseClasses;
            messageArea.innerHTML = message;
            
            switch (type) {
                case 'success':
                    messageArea.classList.add('bg-green-100', 'text-green-800');
                    break;
                case 'error':
                    messageArea.classList.add('bg-red-100', 'text-red-800');
                    break;
                default: // 'info'
                    messageArea.classList.add('bg-blue-100', 'text-blue-800');
                    break;
            }
            messageArea.classList.remove('hidden');
        }

        /**
         * Fetches user profile data from the backend API/USERACCOUNT.
         */
        async function fetchUserProfile() {
            try {
                // In a real application, the browser would automatically send the 
                // session cookie or authorization header after a successful login.
                // We're simulating this by making the request.
                const response = await fetch('/api/usersaccount', {
                    method: 'GET',
                    headers: {
                        // Include headers necessary for authentication, e.g., if using tokens
                        // 'Authorization': 'Bearer ' + localStorage.getItem('token') 
                    }
                });

                if (response.status === 404) {
                    displayMessage('Error: User record not found.', 'error');
                    showView('login');
                    return;
                }
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                const userData = await response.json();
                
                // Populate the profile view with data
                populateProfileView(userData);

                // Switch to the profile view
                showView('profile');

            } catch (error) {
                console.error('Error fetching user account details:', error);
                displayMessage(`Failed to load profile: ${error.message}. Please try logging in again.`, 'error');
                // On critical failure, revert to login view
                showView('login');
            }
        }

        /**
         * Populates the profile view elements with fetched user data.
         * @param {object} data - The structured user object from the API.
         */
        function populateProfileView(data) {
            // Helper function for date formatting
            const formatDate = (dateString) => {
                if (!dateString) return 'N/A';
                return new Date(dateString).toLocaleDateString('en-US', {
                    year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                });
            };

            document.getElementById('profile-id').textContent = data.id || 'N/A';
            
            // Profile Section
            document.getElementById('profile-email').textContent = data.profile.email || 'N/A';
            document.getElementById('profile-name').textContent = 
                `${data.profile.firstName || 'N/A'} ${data.profile.lastName || ''}`.trim();
            document.getElementById('profile-username').textContent = data.profile.username || 'N/A';
            
            // Status Section
            document.getElementById('profile-role').textContent = 
                data.status.role ? data.status.role.toUpperCase() : 'USER';
            document.getElementById('profile-verified').textContent = 
                data.status.isVerified ? 'âœ… Verified' : 'âŒ Not Verified';

            // Membership Section
            document.getElementById('profile-member-since').textContent = formatDate(data.membership.memberSince);
            document.getElementById('profile-last-updated').textContent = formatDate(data.membership.lastUpdated);
        }

        /**
         * Placeholder function for handling login form submission.
         */
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');
            
            loginBtn.textContent = 'Logging in...';
            loginBtn.disabled = true;

            // --- Server-side authentication logic would go here ---
            // Simulate API call to /api/login

            setTimeout(() => {
                loginBtn.textContent = 'Log In';
                loginBtn.disabled = false;

                // For demo, we simulate success for 'test@outflickz.com'
                if (email === 'test@outflickz.com' && password === 'password') {
                    displayMessage(`Login successful! Attempting to load profile...`, 'success');
                    
                    // After successful login, attempt to fetch user profile
                    // We're pretending the session/token is now set.
                    fetchUserProfile(); 
                } else {
                    displayMessage('Login failed. Please check your email and password.', 'error');
                }
            }, 1500); // Simulate network delay
        }

        /**
         * Placeholder function for handling create account form submission.
         */
        function handleCreateAccount(event) {
            event.preventDefault();
            const password = document.getElementById('create-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (password !== confirmPassword) {
                displayMessage('Passwords do not match.', 'error');
                return;
            }

            // --- Server-side account creation logic would go here ---
            displayMessage(`Account creation request sent. Check your email for verification.`, 'info');
            
            setTimeout(() => {
                showView('login');
            }, 3000); 
        }

        /**
         * Placeholder function for handling forgot password form submission.
         */
        function handleForgotPassword(event) {
            event.preventDefault();
            const email = document.getElementById('forgot-email').value;

            // --- Server-side password reset logic would go here ---
            displayMessage(`If an account exists for ${email}, a password reset link has been sent.`, 'success');

            setTimeout(() => {
                showView('login');
            }, 5000);
        }

        /**
         * Placeholder function for handling user logout.
         */
        function handleLogout() {
            // In a real application:
            // 1. Clear local storage/session (e.g., remove token)
            // 2. Call /api/logout endpoint
            displayMessage('You have been successfully logged out.', 'info');
            showView('login');
        }
    </script>
</body>
</html>